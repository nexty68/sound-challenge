<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Sound Challenge</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      font-family: Poppins, sans-serif;
      background: linear-gradient(135deg,#1a1a2e,#16213e);
      color: #fff;
      min-height: 100vh;
    }
    .container { max-width:1200px; margin:0 auto; padding:20px }
    header { text-align:center; padding:30px }
    .logo {
      font-family:Righteous, cursive;
      font-size:3.5rem;
      background:linear-gradient(45deg,#ff6b6b,#4ecdc4);
      -webkit-background-clip:text;
      color:transparent;
      text-shadow:0 5px 15px rgba(0,0,0,0.2);
    }
    .subtitle { opacity:.8; margin-top:10px }
    h2.section-title {
      display:flex; align-items:center; gap:10px;
      color:#4ecdc4; font-size:1.8rem;
    }
    h2.section-title i {
      background:linear-gradient(45deg,#ff6b6b,#4ecdc4);
      -webkit-background-clip:text; color:transparent;
    }

    /* Center the media player */
    .media-container { text-align:center }

    /* Panels */
    .current-media, .recorder-section, .voting-section,
    .results-section, .media-manager, .instructions, #scoreboard {
      background:rgba(255,255,255,0.05);
      border-radius:20px; padding:25px; margin-bottom:30px;
      box-shadow:0 10px 30px rgba(0,0,0,0.3);
      backdrop-filter:blur(10px);
    }
    #original-audio { width:100%; max-width:800px }
    #video-player {
      width:100%; max-width:1000px; height:500px;
      border:none; border-radius:15px;
    }
    .controls {
      display:flex; gap:15px; flex-wrap:wrap;
      justify-content:center; margin-top:20px;
    }
    .btn {
      padding:12px 25px; border:none; border-radius:50px;
      font-weight:600; cursor:pointer; display:flex;
      align-items:center; gap:8px; transition:.3s;
    }
    .btn-primary {
      background:linear-gradient(45deg,#ff6b6b,#ff8e53);
      color:#fff;
    }
    .btn-secondary {
      background:rgba(255,255,255,0.1);
      color:#fff; border:1px solid rgba(255,255,255,0.2);
    }
    .btn-large { font-size:1.2rem }

    .sound-visualizer {
      display:flex; align-items:flex-end; gap:2px;
      height:100px; background:rgba(0,0,0,0.2);
      border-radius:10px; padding:10px; margin:20px 0;
    }
    .visualizer-bar {
      width:8px; background:#4ecdc4;
      border-radius:4px; transition:height .2s;
    }
    .recording-indicator {
      display:flex; align-items:center; gap:10px;
      opacity:0; transition:opacity .3s;
    }
    .recording-indicator.active { opacity:1 }
    .pulse {
      width:15px; height:15px; background:#ff6b6b;
      border-radius:50%; animation:pulse 1.5s infinite;
    }
    .timer { font-weight:600; font-size:1.2rem }
    @keyframes pulse {
      0%   { transform:scale(1) }
      50%  { transform:scale(1.3) }
      100% { transform:scale(1) }
    }

    .players-container {
      display:flex; flex-wrap:wrap; gap:20px;
      justify-content:center;
    }
    .player-card {
      background:rgba(0,0,0,0.2); border-radius:15px;
      padding:20px; width:220px; text-align:center;
    }
    .results-section { display:none; text-align:center }
    #scoreboard { display:none }
    #score-list { list-style:none; padding-left:0 }

    /* Sequence playback */
    progress {
      width:80%; max-width:600px; height:8px;
      margin-bottom:15px;
    }
  </style>
</head>
<body>
  <!-- Join Screen -->
  <div id="join-screen" style="position:fixed;top:0;left:0;
       width:100%;height:100%;background:rgba(0,0,0,0.8);
       display:flex;align-items:center;justify-content:center;z-index:999">
    <div style="background:#16213e;padding:30px;
         border-radius:8px;text-align:center">
      <h2 style="color:#fff;margin-bottom:15px">
        Choisis ton pseudo
      </h2>
      <input id="name-input" placeholder="Ton pseudo"
        style="padding:8px;width:200px;border-radius:4px;
               border:1px solid #4ecdc4;margin-bottom:15px"/>
      <button id="join-btn" class="btn btn-primary">Entrer</button>
    </div>
  </div>

  <!-- Game UI -->
  <div id="game" style="display:none">
    <div class="container">

      <!-- Scoreboard -->
      <div id="scoreboard">
        <h2 class="section-title">
          <i class="fas fa-list-ol"></i> Scoreboard
        </h2>
        <ul id="score-list"></ul>
      </div>

      <!-- M√©dia √† imiter -->
      <div class="current-media">
        <h2 class="section-title">
          <i class="fas fa-play-circle"></i> M√©dia √† imiter
        </h2>
        <div class="media-container">
          <div id="media-title">‚Äì</div>
          <audio id="original-audio" controls style="display:none"></audio>
          <iframe id="video-player" style="display:none"></iframe>
        </div>
      </div>

      <!-- Recorder -->
      <div class="recorder-section">
        <h2 class="section-title">
          <i class="fas fa-microphone-alt"></i> Ton imitation
        </h2>
        <div id="visualizer" class="sound-visualizer"></div>
        <div id="recIndicator" class="recording-indicator">
          <div class="pulse"></div>
          <div id="timer" class="timer">00:05</div>
        </div>
        <div class="controls">
          <button id="recordBtn" class="btn btn-primary btn-large">
            ‚è∫ Enregistrer
          </button>
          <button id="playBtn" class="btn btn-secondary" disabled>
            ‚ñ∂ √âcouter
          </button>
          <button id="submitBtn" class="btn btn-secondary" disabled>
            ‚úâ Soumettre
          </button>
        </div>
      </div>

      <!-- Voting -->
      <div class="voting-section">
        <h2 class="section-title">
          <i class="fas fa-vote-yea"></i> Vote pour le meilleur
        </h2>
        <p id="voting-status">En attente des soumissions‚Ä¶</p>
        <div id="players-container" class="players-container"></div>
        <div class="controls" style="margin-top:20px">
          <button id="showOriginalBtn" class="btn btn-primary">
            üîÅ R√©√©couter original
          </button>
          <!-- Only shown after roundEnded -->
          <button id="playAllBtn" class="btn btn-secondary" style="display:none">
            üîä √âcouter toutes les imitations
          </button>
          <button id="endRoundBtn" class="btn btn-secondary" style="display:none">
            üõë Terminer la manche
          </button>
          <button id="nextRoundBtn" class="btn btn-primary" style="display:none">
            ‚è≠ Manche suivante
          </button>
        </div>
      </div>

      <!-- Sequence Playback -->
      <div id="sequence-playback" style="display:none;text-align:center;margin-bottom:30px">
        <h2 class="section-title">
          <i class="fas fa-play-circle"></i> Relecture des imitations
        </h2>
        <div id="seq-progress" style="margin-bottom:8px;font-weight:600">
          0/0
        </div>
        <progress id="seq-bar" value="0" max="0"></progress>
        <div>
          <div id="seq-player-name" style="font-size:1.5rem;margin:10px 0;>‚Äì</div>
          <audio id="seq-audio" controls style="width:80%;max-width:600px"></audio>
        </div>
      </div>

      <!-- Results -->
      <div id="results-section" class="results-section">
        <h2 class="section-title">
          <i class="fas fa-trophy"></i> R√©sultats
        </h2>
        <div class="winner-card">
          <div class="winner-title">Gagnant :</div>
          <div class="winner-avatar"><i class="fas fa-crown"></i></div>
          <div id="winner-name">‚Äì</div>
          <p>avec <span id="winner-votes">0</span> points</p>
          <audio id="winner-audio" controls style="display:none;width:100%;margin-top:20px"></audio>
        </div>
      </div>

      <!-- Media Manager -->
      <div class="media-manager">
        <h2 class="section-title"><i class="fas fa-music"></i> Gestion des m√©dias</h2>
        <div id="media-list"></div>
      </div>

      <!-- Instructions -->
      <div class="instructions">
        <h3><i class="fas fa-info-circle"></i> Comment ajouter des m√©dias</h3>
        <p>D√©pose tes MP3/WAV/MP4 dans <code>public/media/</code></p>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded',()=> {
      // (All your existing JS logic, unchanged,
      // except for two small moves:)
      //
      // 1) In the roundEnded handler:
      //    playAllBtn.style.display = 'inline-block';
      //
      // 2) In playAllBtn.onclick:
      //    sequencePlayback.style.display = 'block';
      //
      // Everything else remains exactly as before.

      // ‚Ä¶ your JS here ‚Ä¶

    });
  </script>
</body>
</html>
